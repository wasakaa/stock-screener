<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Screener AI Pro - HNX & UPCOM</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; color: #333; }
        .container { max-width: 1600px; margin: 0 auto; }

        /* Header */
        header { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); margin-bottom: 30px; }
        h1 { color: #667eea; margin-bottom: 10px; font-size: 32px; }
        .subtitle { color: #666; font-size: 14px; margin-bottom: 15px; }
        .header-actions { display: flex; gap: 15px; flex-wrap: wrap; margin-top: 20px; }
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; font-size: 14px; }
        .btn-primary { background: #667eea; color: white; }
        .btn-primary:hover { background: #5568d3; transform: translateY(-2px); }
        .watchlist-count { background: #ef4444; color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; margin-left: 5px; }

        /* Tabs */
        .tabs { background: white; border-radius: 15px; margin-bottom: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .tab-buttons { display: flex; background: #f8f9fa; flex-wrap: wrap; }
        .tab-btn { flex: 1; min-width: 150px; padding: 15px; border: none; background: transparent; cursor: pointer; font-weight: 600; transition: all 0.3s; border-bottom: 3px solid transparent; font-size: 14px; }
        .tab-btn.active { background: white; border-bottom-color: #667eea; color: #667eea; }
        .tab-btn:hover { background: #f0f0f0; }
        .tab-content { display: none; padding: 20px; }
        .tab-content.active { display: block; }

        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); text-align: center; transition: transform 0.3s; }
        .stat-card:hover { transform: translateY(-5px); }
        .stat-card h3 { font-size: 32px; color: #667eea; margin-bottom: 5px; }
        .stat-card p { color: #666; font-size: 13px; }

        /* Filters */
        .filters { background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .filter-group { display: flex; gap: 15px; flex-wrap: wrap; align-items: center; }
        .filter-group label { font-weight: 600; font-size: 14px; }
        .filter-group select, .filter-group input { padding: 10px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 14px; }
        .filter-group select:focus, .filter-group input:focus { outline: none; border-color: #667eea; }

        /* Stock Grid */
        .stock-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(400px, 1fr)); gap: 20px; }
        .stock-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: all 0.3s; position: relative; border-left: 5px solid #667eea; }
        .stock-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }

        .stock-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; }
        .ticker { font-size: 24px; font-weight: bold; color: #667eea; cursor: pointer; }
        .ticker:hover { text-decoration: underline; }
        .exchange { background: #764ba2; color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }

        .price { font-size: 28px; font-weight: bold; margin-bottom: 15px; color: #333; }

        /* AI Recommendation Badge */
        .ai-recommendation { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px; border-radius: 8px; margin-bottom: 15px; }
        .ai-rec-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
        .ai-rec-action { font-size: 18px; font-weight: bold; }
        .ai-confidence { font-size: 12px; opacity: 0.9; }
        .ai-score { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 15px; font-size: 12px; }

        /* Trading Style Badge */
        .trading-style { background: #f8f9fa; padding: 10px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #f59e0b; }
        .style-header { font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        .style-reason { font-size: 12px; color: #666; line-height: 1.5; }
        .holding-period { display: inline-block; background: #fef3c7; color: #92400e; padding: 3px 8px; border-radius: 12px; font-size: 11px; margin-top: 5px; }

        /* Price Targets */
        .price-targets { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .target-box { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .target-label { font-size: 11px; color: #666; text-transform: uppercase; margin-bottom: 4px; }
        .target-value { font-weight: 700; font-size: 14px; color: #333; }
        .target-box.entry { border-left: 3px solid #3b82f6; }
        .target-box.target { border-left: 3px solid #10b981; }
        .target-box.stop { border-left: 3px solid #ef4444; }

        /* Indicators */
        .indicators { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 15px; }
        .indicator { background: #f8f9fa; padding: 10px; border-radius: 6px; text-align: center; }
        .indicator-label { color: #666; font-size: 11px; text-transform: uppercase; margin-bottom: 4px; }
        .indicator-value { font-weight: 700; font-size: 16px; }
        .rsi-oversold { color: #10b981; }
        .rsi-overbought { color: #ef4444; }
        .rsi-neutral { color: #f59e0b; }

        /* Signals */
        .signals { margin-top: 15px; }
        .signal-tag { display: inline-block; padding: 6px 12px; margin: 4px 4px 4px 0; border-radius: 20px; font-size: 12px; font-weight: 500; background: #f0f0f0; }
        .signal-tag.bullish { background: #d1fae5; color: #065f46; }
        .signal-tag.bearish { background: #fee2e2; color: #991b1b; }

        /* ML Prediction */
        .ml-prediction { background: #eff6ff; padding: 10px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #3b82f6; }
        .ml-prediction-label { font-size: 11px; color: #1e40af; font-weight: 600; margin-bottom: 5px; }
        .ml-prediction-value { font-size: 14px; font-weight: bold; color: #1e3a8a; }

        .watchlist-toggle { position: absolute; top: 15px; right: 15px; background: white; border: 2px solid #667eea; color: #667eea; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s; font-size: 18px; }
        .watchlist-toggle:hover { background: #667eea; color: white; transform: scale(1.1); }
        .watchlist-toggle.active { background: #667eea; color: white; }

        /* Modal */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); overflow-y: auto; }
        .modal-content { background: white; margin: 2% auto; padding: 30px; width: 90%; max-width: 1200px; border-radius: 15px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f0f0f0; }
        .close { color: #aaa; font-size: 35px; font-weight: bold; cursor: pointer; line-height: 1; }
        .close:hover { color: #000; }
        .chart-container { position: relative; height: 400px; margin-bottom: 30px; }
        .indicator-charts { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        .indicator-chart { position: relative; height: 200px; }

        /* AI Details in Modal */
        .ai-details { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        .ai-details h3 { color: #667eea; margin-bottom: 15px; }
        .ai-detail-row { margin-bottom: 10px; padding: 10px; background: white; border-radius: 6px; }

        .no-results { text-align: center; padding: 60px; background: white; border-radius: 12px; color: #666; }

        /* Learning Insights */
        .insights-section { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .insight-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px; border-radius: 10px; margin-bottom: 15px; }
        .insight-card h4 { margin-bottom: 8px; font-size: 16px; }
        .insight-card p { font-size: 14px; line-height: 1.6; opacity: 0.95; }

        @media (max-width: 768px) { 
            .stock-grid { grid-template-columns: 1fr; }
            .indicator-charts { grid-template-columns: 1fr; }
            .tab-btn { min-width: 120px; font-size: 12px; padding: 12px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ Stock Screener AI Pro</h1>
            <p class="subtitle">AI-Powered Stock Analysis v·ªõi 4 Levels Machine Learning + Trading Style Recommendations</p>
            <p class="subtitle">C·∫≠p nh·∫≠t: <span id="lastUpdate"></span> | T·ªïng: <span id="totalStocks"></span> m√£</p>
            <div class="header-actions">
                <button class="btn btn-primary" onclick="showTab('all')">üìä T·∫•t c·∫£ m√£</button>
                <button class="btn btn-primary" onclick="showTab('watchlist')">‚≠ê Watchlist <span class="watchlist-count" id="watchlistCount">0</span></button>
                <button class="btn btn-primary" onclick="showTab('swing')">‚ö° L∆∞·ªõt s√≥ng</button>
                <button class="btn btn-primary" onclick="showTab('longterm')">üìà D√†i h·∫°n</button>
                <button class="btn btn-primary" onclick="showTab('insights')">üéì AI Insights</button>
            </div>
        </header>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('all')">T·∫•t c·∫£ m√£</button>
                <button class="tab-btn" onclick="showTab('watchlist')">‚≠ê Watchlist</button>
                <button class="tab-btn" onclick="showTab('swing')">‚ö° L∆∞·ªõt s√≥ng</button>
                <button class="tab-btn" onclick="showTab('longterm')">üìà D√†i h·∫°n</button>
                <button class="tab-btn" onclick="showTab('strong-buy')">üü¢ Strong Buy</button>
                <button class="tab-btn" onclick="showTab('insights')">üéì AI Insights</button>
            </div>
        </div>

        <div class="tab-content active" id="tab-all">
            <div class="stats">
                <div class="stat-card"><h3 id="totalStocksCard">0</h3><p>T·ªïng s·ªë m√£</p></div>
                <div class="stat-card"><h3 id="strongBuyCount">0</h3><p>Strong Buy</p></div>
                <div class="stat-card"><h3 id="swingCount">0</h3><p>L∆∞·ªõt s√≥ng</p></div>
                <div class="stat-card"><h3 id="longtermCount">0</h3><p>D√†i h·∫°n</p></div>
                <div class="stat-card"><h3 id="oversoldCount">0</h3><p>RSI Oversold</p></div>
                <div class="stat-card"><h3 id="macdBullish">0</h3><p>MACD Bullish</p></div>
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label>S√†n:</label>
                    <select id="exchangeFilter">
                        <option value="ALL">T·∫•t c·∫£</option>
                        <option value="HNX">HNX</option>
                        <option value="UPCOM">UPCOM</option>
                    </select>

                    <label>AI Action:</label>
                    <select id="actionFilter">
                        <option value="ALL">T·∫•t c·∫£</option>
                        <option value="STRONG_BUY">Strong Buy</option>
                        <option value="BUY">Buy</option>
                        <option value="HOLD">Hold</option>
                        <option value="SELL">Sell</option>
                    </select>

                    <label>Trading Style:</label>
                    <select id="styleFilter">
                        <option value="ALL">T·∫•t c·∫£</option>
                        <option value="SWING">L∆∞·ªõt s√≥ng</option>
                        <option value="LONGTERM">D√†i h·∫°n</option>
                    </select>

                    <label>RSI:</label>
                    <select id="rsiFilter">
                        <option value="ALL">T·∫•t c·∫£</option>
                        <option value="OVERSOLD">Oversold (<30)</option>
                        <option value="OVERBOUGHT">Overbought (>70)</option>
                    </select>

                    <label>S·∫Øp x·∫øp:</label>
                    <select id="sortFilter">
                        <option value="ai_score">AI Score cao nh·∫•t</option>
                        <option value="confidence">Confidence cao nh·∫•t</option>
                        <option value="ticker">Theo m√£</option>
                    </select>

                    <label>T√¨m m√£:</label>
                    <input type="text" id="searchTicker" placeholder="VD: CEO, KCB...">
                </div>
            </div>

            <div id="stockGrid" class="stock-grid"></div>
        </div>

        <div class="tab-content" id="tab-watchlist">
            <div id="watchlistGrid" class="stock-grid"></div>
        </div>

        <div class="tab-content" id="tab-swing">
            <h2 style="color: white; margin-bottom: 20px;">‚ö° M√£ ph√π h·ª£p L∆Ø·ªöT S√ìNG (3-10 ng√†y)</h2>
            <div id="swingGrid" class="stock-grid"></div>
        </div>

        <div class="tab-content" id="tab-longterm">
            <h2 style="color: white; margin-bottom: 20px;">üìà M√£ ph√π h·ª£p D√ÄI H·∫†N (1-3 th√°ng)</h2>
            <div id="longtermGrid" class="stock-grid"></div>
        </div>

        <div class="tab-content" id="tab-strong-buy">
            <h2 style="color: white; margin-bottom: 20px;">üü¢ Strong Buy - AI Recommend</h2>
            <div id="strongBuyGrid" class="stock-grid"></div>
        </div>

        <div class="tab-content" id="tab-insights">
            <div class="insights-section">
                <h2 style="margin-bottom: 20px; color: #667eea;">üéì AI Learning Insights</h2>
                <div id="insightsContainer"></div>
            </div>
        </div>
    </div>

    <!-- Chart Modal -->
    <div id="chartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Chart Loading...</h2>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            <div id="aiDetailsModal" class="ai-details"></div>
            <div class="chart-container">
                <canvas id="priceChart"></canvas>
            </div>
            <div class="indicator-charts">
                <div class="indicator-chart"><canvas id="rsiChart"></canvas></div>
                <div class="indicator-chart"><canvas id="macdChart"></canvas></div>
            </div>
        </div>
    </div>

    <script>
        let allStocks = [];
        let watchlist = JSON.parse(localStorage.getItem('watchlist') || '[]');
        let currentCharts = [];
        let learningInsights = [];

        // Load AI data
        fetch('stocks_data_ai_complete.json')
            .then(res => res.json())
            .then(data => {
                allStocks = data.stocks;
                learningInsights = data.learning_insights || [];

                document.getElementById('lastUpdate').textContent = data.last_update;
                document.getElementById('totalStocks').textContent = data.total_stocks;

                updateStats();
                renderStocks(allStocks, 'stockGrid');
                updateWatchlistCount();
                renderInsights();
            })
            .catch(err => {
                console.error('Error loading data:', err);
                document.getElementById('stockGrid').innerHTML = '<div class="no-results">Kh√¥ng th·ªÉ load data. Ki·ªÉm tra file stocks_data_ai_complete.json</div>';
            });

        function updateStats() {
            document.getElementById('totalStocksCard').textContent = allStocks.length;
            document.getElementById('strongBuyCount').textContent = allStocks.filter(s => s.ai_ensemble.final_action === 'STRONG_BUY').length;
            document.getElementById('swingCount').textContent = allStocks.filter(s => s.trading_style.recommended_style === 'SWING').length;
            document.getElementById('longtermCount').textContent = allStocks.filter(s => s.trading_style.recommended_style === 'LONGTERM').length;
            document.getElementById('oversoldCount').textContent = allStocks.filter(s => s.rsi < 30).length;
            document.getElementById('macdBullish').textContent = allStocks.filter(s => s.macd > s.macd_signal).length;
        }

        // Filters
        document.getElementById('exchangeFilter')?.addEventListener('change', applyFilters);
        document.getElementById('actionFilter')?.addEventListener('change', applyFilters);
        document.getElementById('styleFilter')?.addEventListener('change', applyFilters);
        document.getElementById('rsiFilter')?.addEventListener('change', applyFilters);
        document.getElementById('sortFilter')?.addEventListener('change', applyFilters);
        document.getElementById('searchTicker')?.addEventListener('input', applyFilters);

        function applyFilters() {
            let filtered = [...allStocks];

            const exchange = document.getElementById('exchangeFilter').value;
            if (exchange !== 'ALL') filtered = filtered.filter(s => s.exchange === exchange);

            const action = document.getElementById('actionFilter').value;
            if (action !== 'ALL') filtered = filtered.filter(s => s.ai_ensemble.final_action === action);

            const style = document.getElementById('styleFilter').value;
            if (style !== 'ALL') filtered = filtered.filter(s => s.trading_style.recommended_style === style);

            const rsi = document.getElementById('rsiFilter').value;
            if (rsi === 'OVERSOLD') filtered = filtered.filter(s => s.rsi < 30);
            else if (rsi === 'OVERBOUGHT') filtered = filtered.filter(s => s.rsi > 70);

            const search = document.getElementById('searchTicker').value.toUpperCase();
            if (search) filtered = filtered.filter(s => s.ticker.includes(search));

            const sort = document.getElementById('sortFilter').value;
            filtered.sort((a, b) => {
                if (sort === 'ai_score') return b.ai_ensemble.composite_score - a.ai_ensemble.composite_score;
                if (sort === 'confidence') return b.ai_ensemble.confidence - a.ai_ensemble.confidence;
                if (sort === 'ticker') return a.ticker.localeCompare(b.ticker);
                return 0;
            });

            renderStocks(filtered, 'stockGrid');
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            if (tabName === 'all') {
                document.getElementById('tab-all').classList.add('active');
                document.querySelectorAll('.tab-btn')[0].classList.add('active');
                renderStocks(allStocks, 'stockGrid');
            } else if (tabName === 'watchlist') {
                document.getElementById('tab-watchlist').classList.add('active');
                document.querySelectorAll('.tab-btn')[1].classList.add('active');
                const watchlistStocks = allStocks.filter(s => watchlist.includes(s.ticker));
                renderStocks(watchlistStocks, 'watchlistGrid');
            } else if (tabName === 'swing') {
                document.getElementById('tab-swing').classList.add('active');
                document.querySelectorAll('.tab-btn')[2].classList.add('active');
                const swingStocks = allStocks.filter(s => s.trading_style.recommended_style === 'SWING');
                renderStocks(swingStocks, 'swingGrid');
            } else if (tabName === 'longterm') {
                document.getElementById('tab-longterm').classList.add('active');
                document.querySelectorAll('.tab-btn')[3].classList.add('active');
                const longtermStocks = allStocks.filter(s => s.trading_style.recommended_style === 'LONGTERM');
                renderStocks(longtermStocks, 'longtermGrid');
            } else if (tabName === 'strong-buy') {
                document.getElementById('tab-strong-buy').classList.add('active');
                document.querySelectorAll('.tab-btn')[4].classList.add('active');
                const strongBuy = allStocks.filter(s => s.ai_ensemble.final_action === 'STRONG_BUY');
                renderStocks(strongBuy, 'strongBuyGrid');
            } else if (tabName === 'insights') {
                document.getElementById('tab-insights').classList.add('active');
                document.querySelectorAll('.tab-btn')[5].classList.add('active');
            }
        }

        function toggleWatchlist(ticker) {
            const index = watchlist.indexOf(ticker);
            if (index > -1) {
                watchlist.splice(index, 1);
            } else {
                watchlist.push(ticker);
            }
            localStorage.setItem('watchlist', JSON.stringify(watchlist));
            updateWatchlistCount();

            document.querySelectorAll(`[data-ticker="${ticker}"]`).forEach(btn => {
                btn.classList.toggle('active');
            });
        }

        function updateWatchlistCount() {
            document.getElementById('watchlistCount').textContent = watchlist.length;
        }

        function renderStocks(stocks, containerId) {
            const grid = document.getElementById(containerId);

            if (stocks.length === 0) {
                grid.innerHTML = '<div class="no-results">Kh√¥ng t√¨m th·∫•y m√£ n√†o ph√π h·ª£p</div>';
                return;
            }

            grid.innerHTML = stocks.map(stock => {
                const ai = stock.ai_ensemble;
                const style = stock.trading_style;
                const l1 = stock.ai_level1;
                const l3 = stock.ai_level3;
                const rsiClass = stock.rsi < 30 ? 'rsi-oversold' : stock.rsi > 70 ? 'rsi-overbought' : 'rsi-neutral';
                const isWatchlisted = watchlist.includes(stock.ticker);

                return `
                <div class="stock-card">
                    <div class="watchlist-toggle ${isWatchlisted ? 'active' : ''}" data-ticker="${stock.ticker}" onclick="toggleWatchlist('${stock.ticker}')">
                        ${isWatchlisted ? '‚òÖ' : '‚òÜ'}
                    </div>

                    <div class="stock-header">
                        <div class="ticker" onclick="showChart('${stock.ticker}')">${stock.ticker}</div>
                        <div class="exchange">${stock.exchange}</div>
                    </div>

                    <div class="price">${stock.price.toLocaleString('vi-VN')} VND</div>

                    <div class="ai-recommendation">
                        <div class="ai-rec-header">
                            <div class="ai-rec-action">${ai.final_label}</div>
                            <div class="ai-score">Score: ${ai.composite_score}/10</div>
                        </div>
                        <div class="ai-confidence">Confidence: ${ai.confidence}%</div>
                    </div>

                    <div class="trading-style">
                        <div class="style-header">${style.style_label} ${style.holding_period}</div>
                        <div class="style-reason">${style.explanation}</div>
                        <span class="holding-period">N·∫Øm gi·ªØ: ${style.holding_period}</span>
                    </div>

                    <div class="price-targets">
                        <div class="target-box entry">
                            <div class="target-label">Entry</div>
                            <div class="target-value">${ai.entry_zone}</div>
                        </div>
                        <div class="target-box target">
                            <div class="target-label">Target</div>
                            <div class="target-value">${ai.target_zone}</div>
                        </div>
                        <div class="target-box stop">
                            <div class="target-label">Stop</div>
                            <div class="target-value">${ai.stop_loss}</div>
                        </div>
                    </div>

                    <div class="indicators">
                        <div class="indicator">
                            <div class="indicator-label">RSI</div>
                            <div class="indicator-value ${rsiClass}">${stock.rsi.toFixed(1)}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">MACD</div>
                            <div class="indicator-value">${stock.macd > stock.macd_signal ? 'üìà' : 'üìâ'}</div>
                        </div>
                        <div class="indicator">
                            <div class="indicator-label">Vol Spike</div>
                            <div class="indicator-value">${stock.vol_spike.toFixed(1)}x</div>
                        </div>
                    </div>

                    <div class="ml-prediction">
                        <div class="ml-prediction-label">ü§ñ ML Prediction (5 ng√†y):</div>
                        <div class="ml-prediction-value">${l3.predicted_change_5d > 0 ? '+' : ''}${l3.predicted_change_5d}% ‚Üí ${l3.predicted_price_5d}</div>
                    </div>

                    ${l1.buy_signals.length > 0 ? `
                        <div class="signals">
                            ${l1.buy_signals.slice(0, 3).map(sig => `<span class="signal-tag bullish">${sig}</span>`).join('')}
                        </div>
                    ` : ''}
                </div>
            `}).join('');
        }

        function renderInsights() {
            const container = document.getElementById('insightsContainer');
            container.innerHTML = learningInsights.map(insight => `
                <div class="insight-card">
                    <h4>üìä ${insight.category}</h4>
                    <p><strong>${insight.insight}</strong></p>
                    <p>üí° ${insight.recommendation}</p>
                </div>
            `).join('');
        }

        function showChart(ticker) {
            const stock = allStocks.find(s => s.ticker === ticker);
            if (!stock) return;

            document.getElementById('modalTitle').textContent = `${ticker} - ${stock.exchange}`;
            document.getElementById('chartModal').style.display = 'block';

            // AI Details
            const ai = stock.ai_ensemble;
            const style = stock.trading_style;
            const l1 = stock.ai_level1;
            const l3 = stock.ai_level3;

            document.getElementById('aiDetailsModal').innerHTML = `
                <h3>ü§ñ AI Analysis</h3>
                <div class="ai-detail-row">
                    <strong>Recommendation:</strong> ${ai.final_label} (Confidence: ${ai.confidence}%)
                </div>
                <div class="ai-detail-row">
                    <strong>Trading Style:</strong> ${style.style_label} - ${style.holding_period}
                </div>
                <div class="ai-detail-row">
                    <strong>Entry Zone:</strong> ${ai.entry_zone} | <strong>Target:</strong> ${ai.target_zone} | <strong>Stop:</strong> ${ai.stop_loss}
                </div>
                <div class="ai-detail-row">
                    <strong>ML Prediction (5d):</strong> ${l3.predicted_change_5d > 0 ? '+' : ''}${l3.predicted_change_5d}% ‚Üí ${l3.predicted_price_5d}
                </div>
                <div class="ai-detail-row">
                    <strong>L√Ω do:</strong> ${l1.buy_signals.join(', ') || l1.sell_signals.join(', ')}
                </div>
            `;

            // Clear old charts
            currentCharts.forEach(chart => chart.destroy());
            currentCharts = [];

            // Chart data
            const chartData = stock.chart_data;
            const dates = chartData.dates;
            const closes = chartData.close;
            const rsiData = chartData.rsi;
            const macdData = chartData.macd;
            const macdSignal = chartData.macd_signal;

            // Price Chart
            const priceChart = new Chart(document.getElementById('priceChart'), {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'Gi√°',
                        data: closes,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: 'Bi·ªÉu ƒë·ªì gi√° 60 ng√†y' } }
                }
            });

            // RSI Chart
            const rsiChart = new Chart(document.getElementById('rsiChart'), {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: 'RSI',
                        data: rsiData,
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: 'RSI (14)' } },
                    scales: { y: { min: 0, max: 100 } }
                }
            });

            // MACD Chart
            const macdChart = new Chart(document.getElementById('macdChart'), {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [
                        {
                            label: 'MACD',
                            data: macdData,
                            borderColor: '#667eea',
                            tension: 0.4
                        },
                        {
                            label: 'Signal',
                            data: macdSignal,
                            borderColor: '#ef4444',
                            tension: 0.4
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { title: { display: true, text: 'MACD (12,26,9)' } }
                }
            });

            currentCharts = [priceChart, rsiChart, macdChart];
        }

        function closeModal() {
            document.getElementById('chartModal').style.display = 'none';
        }

        window.onclick = function(event) {
            const modal = document.getElementById('chartModal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        }
    </script>
</body>
</html>
